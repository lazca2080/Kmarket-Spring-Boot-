<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.co.kmarket.dao.AdminCsDAO">
    <!--============== 관리자 고객센터 ===============-->
    <insert id="insertArticleNotice">
        INSERT INTO `km_cs_notice` SET
            `uid` = #{uid},
            `cateType1` = #{cateType1},
            `title` = #{title},
            `content` = #{content},
            `regip` = #{regip},
            `rdate` = NOW();
    </insert>

    <insert id="insertArticleFaq">
        INSERT INTO `km_cs_faq` SET
        `uid` = #{uid},
        `cateType1` = #{cateType1},
        `cateType2` = #{cateType2},
        `title` = #{title},
        `content` = #{content},
        `regip` = #{regip},
        `rdate` = NOW();
    </insert>

    <select id="noticeSelectOne" resultType="kr.co.kmarket.vo.CsVO">
        SELECT * FROM `km_cs_notice` WHERE `no`=#{no};
    </select>
    <select id="faqSelectOne" resultType="kr.co.kmarket.vo.CsVO">
        SELECT * FROM `km_cs_faq` WHERE `no`=#{no};
    </select>

    <select id="qnaSelectOne" resultType="kr.co.kmarket.vo.CsVO">
        SELECT * FROM `km_cs_qna` WHERE `no`=#{no};
    </select>

    <select id="selectAdminCSnotice" parameterType="kr.co.kmarket.vo.CsVO" resultType="kr.co.kmarket.vo.CsVO">
        SELECT * FROM `km_cs_notice` WHERE 1=1
        <include refid="searchCateType"/>
        ORDER BY `no` DESC LIMIT #{start},10;
    </select>

    <select id="selectAdminCSfaq" resultType="kr.co.kmarket.vo.CsVO">
        SELECT * FROM `km_cs_faq` WHERE 1=1 ORDER BY `no` DESC LIMIT #{start},10;
    </select>

    <select id="selectAdminCSqna" resultType="kr.co.kmarket.vo.CsVO">
        SELECT * FROM `km_cs_qna` WHERE 1=1 ORDER BY `no` DESC LIMIT #{start},10;
    </select>

    <select id="selectAdminNoticeTotal" resultType="int">
        SELECT COUNT(*) FROM `km_cs_notice`;
    </select>

    <select id="selectAdminQnaTotal" resultType="int">
        SELECT COUNT(*) FROM `km_cs_qna`;
    </select>

    <select id="selectAdminFaqTotal" resultType="int">
        SELECT COUNT(*) FROM `km_cs_faq`;
    </select>

    <update id="updateNotice">
        UPDATE `km_cs_notice` SET
            `cateType1` = #{cateType1},
            `title` = #{title},
            `content` = #{content},
            `rdate`= NOW()
        WHERE
            `no`=#{no};
    </update>
    <update id="updateFaq">
        UPDATE `km_cs_faq` SET
        `cateType1` = #{cateType1},
        `cateType2` = #{cateType2},
        `title` = #{title},
        `content` = #{content},
        `rdate`= NOW()
        WHERE
        `no`=#{no};
    </update>

    <update id="updateReply" parameterType="kr.co.kmarket.vo.CsVO">
        UPDATE `km_cs_qna` SET
            `reply`=#{reply}
        WHERE
            `no`=#{no};
    </update>

    <!-- 삭제 -->
    <delete id="checkDeleteNotice">
        delete from `km_cs_notice` where `no` = #{no};
    </delete>
    <delete id="checkDeleteFaq">
        delete from `km_cs_faq` where `no` = #{no};
    </delete>
    <delete id="checkDeleteQna">
        delete from `km_cs_qna` where `no` = #{no};
    </delete>


    <!--========공통 키==========-->
    <sql id="searchCateType">
        <if test="searchType != null">
            <choose>
                <when test='searchType == "고객서비스"'>
                    AND cateType1 = #{searchType}
                </when>
                <when test='searchType == "안전거래"'>
                    AND cateType1 LIKE CONCAT('%',#{searchType},'%')
                </when>
                <when test='searchType == "위해상품"'>
                    AND cateType1 LIKE CONCAT('%',#{searchType},'%')
                </when>
                <when test='searchType == "이벤트당첨"'>
                    AND cateType1 LIKE CONCAT('%',#{searchType},'%')
                </when>

            </choose>
        </if>
    </sql>
</mapper>